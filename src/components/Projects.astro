---
import { projects } from '../data/projects';
import BrowserMockup from './BrowserMockup.astro';
---

<section id="projects" class="relative border-t border-white/10 bg-zinc-950 px-6 py-32 text-white md:px-12">
  <div class="mx-auto max-w-7xl">
    <div class="projects-header mb-24 flex items-end justify-between border-b border-white/10 pb-8">
      <h2 class="text-6xl font-bold tracking-tighter text-white md:text-8xl">
        SELECTED<br />WORKS
      </h2>
      <span class="mb-2 hidden font-mono text-sm text-zinc-400 md:block">
        (2023 â€” {new Date().getFullYear()})
      </span>
    </div>

    <div class="flex flex-col gap-32">
      {
        projects.map((project, index) => (
          <article class="project-card group" data-index={index}>
            {/* Project Header */}
            <div class="mb-8 flex flex-wrap items-baseline justify-between gap-4">
              <div class="flex items-baseline gap-4">
                <span class="font-mono text-sm text-zinc-500">
                  {String(index + 1).padStart(2, '0')}
                </span>
                <h3 class="text-3xl font-bold tracking-tight md:text-5xl">
                  {project.title}
                </h3>
              </div>
              <div class="flex flex-wrap gap-2">
                {project.tech.slice(0, 4).map((t) => (
                  <span class="rounded-full border border-white/10 px-3 py-1 text-xs tracking-widest text-zinc-400 uppercase">
                    {t}
                  </span>
                ))}
              </div>
            </div>

            {/* Browser Mockup */}
            <a
              href={project.link}
              target="_blank"
              rel="noopener noreferrer"
              class="block"
            >
              <BrowserMockup
                src={project.cover}
                alt={project.title}
                url={project.link.replace('https://', '')}
              />
            </a>

            {/* Project Footer */}
            <div class="mt-8 flex flex-wrap items-end justify-between gap-6">
              <p class="max-w-xl text-lg leading-relaxed text-zinc-400">
                {project.blurb}
              </p>
              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="project-link magnetic inline-flex items-center gap-2 text-sm font-bold tracking-widest uppercase"
              >
                <span>View Project</span>
                <svg
                  class="project-arrow"
                  width="12"
                  height="12"
                  viewBox="0 0 10 10"
                  fill="none"
                >
                  <path
                    d="M1 9L9 1M9 1H1M9 1V9"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </a>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';

import { addHoverAnimation, COLOR, DURATION, EASE, isMobile } from '../utils/animations';

  if (isMobile) {
    gsap.fromTo('.projects-header',
      { opacity: 0 },
      { opacity: 1, duration: 0.5, ease: EASE.DEFAULT,
        scrollTrigger: { trigger: '.projects-header', start: 'top 85%', once: true } },
    );
  } else {
    gsap.fromTo('.projects-header',
      { opacity: 0, clipPath: 'inset(0 100% 0 0)' },
      { opacity: 1, clipPath: 'inset(0 0% 0 0)', duration: 1.2, ease: EASE.STRONG_IN_OUT,
        scrollTrigger: { trigger: '.projects-header', start: 'top 80%', once: true } },
    );
  }

  for (const card of document.querySelectorAll('.project-card')) {
    if (isMobile) {
      gsap.fromTo(card,
        { opacity: 0, y: 30 },
        { opacity: 1, y: 0, duration: 0.5, ease: EASE.DEFAULT, overwrite: true,
          scrollTrigger: { trigger: card, start: 'top 90%', once: true } },
      );
    } else {
      const index = Number(card.getAttribute('data-index'));
      const fromX = index % 2 === 0 ? -60 : 60;
      gsap.fromTo(card,
        { opacity: 0, x: fromX },
        { opacity: 1, x: 0, duration: 1, ease: EASE.SMOOTH, overwrite: true,
          scrollTrigger: { trigger: card, start: 'top 85%', once: true } },
      );
    }
  }

  if (!isMobile) {
    for (const screen of document.querySelectorAll('.mockup-screen')) {
      gsap.fromTo(screen,
        { y: 16 },
        {
          y: -16,
          ease: 'none',
          scrollTrigger: {
            trigger: screen.closest('article'),
            start: 'top bottom',
            end: 'bottom top',
            scrub: 1.5,
          },
        },
      );
    }

    for (const link of document.querySelectorAll('.project-link')) {
      const arrow = link.querySelector('.project-arrow');
      if (!arrow) continue;
      addHoverAnimation(link as Element, [
        {
          target: link as Element,
          enter: { color: COLOR.ZINC_400, duration: DURATION.DEFAULT },
          leave: { color: COLOR.WHITE, duration: DURATION.DEFAULT },
        },
        {
          target: arrow,
          enter: { x: 3, y: -3, duration: DURATION.DEFAULT, ease: EASE.DEFAULT },
          leave: { x: 0, y: 0, duration: DURATION.DEFAULT, ease: EASE.DEFAULT },
        },
      ]);
    }
  }
</script>
