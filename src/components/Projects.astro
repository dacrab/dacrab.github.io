---
import { projects } from '../data/projects';
import BrowserMockup from './BrowserMockup.astro';
---

<section id="projects" class="relative border-t border-white/10 bg-zinc-950 px-6 py-32 text-white md:px-12">
  <div class="mx-auto max-w-7xl">
    <div class="projects-header mb-24 flex items-end justify-between border-b border-white/10 pb-8">
      <h2 class="text-6xl font-bold tracking-tighter text-white md:text-8xl">
        SELECTED<br />WORKS
      </h2>
      <span class="mb-2 hidden font-mono text-sm text-zinc-400 md:block">
        (2023 â€” {new Date().getFullYear()})
      </span>
    </div>

    <div class="flex flex-col gap-32">
      {
        projects.map((project, index) => (
          <article class="project-card group" data-index={index}>
            <!-- Project Header -->
            <div class="mb-8 flex flex-wrap items-baseline justify-between gap-4">
              <div class="flex items-baseline gap-4">
                <span class="font-mono text-sm text-zinc-500">
                  {String(index + 1).padStart(2, '0')}
                </span>
                <h3 class="text-3xl font-bold tracking-tight md:text-5xl">
                  {project.title}
                </h3>
              </div>
              <div class="flex flex-wrap gap-2">
                {project.tech.slice(0, 4).map((t) => (
                  <span class="rounded-full border border-white/10 px-3 py-1 text-xs tracking-widest text-zinc-400 uppercase">
                    {t}
                  </span>
                ))}
              </div>
            </div>

            <!-- Browser Mockup -->
            <a
              href={project.link}
              target="_blank"
              rel="noopener noreferrer"
              class="block"
            >
              <BrowserMockup
                src={project.cover}
                alt={project.title}
                url={project.link.replace('https://', '')}
              />
            </a>

            <!-- Project Footer -->
            <div class="mt-8 flex flex-wrap items-end justify-between gap-6">
              <p class="max-w-xl text-lg leading-relaxed text-zinc-400">
                {project.blurb}
              </p>
              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="project-link magnetic inline-flex items-center gap-2 text-sm font-bold tracking-widest uppercase"
              >
                <span>View Project</span>
                <svg
                  class="project-arrow"
                  width="12"
                  height="12"
                  viewBox="0 0 10 10"
                  fill="none"
                >
                  <path
                    d="M1 9L9 1M9 1H1M9 1V9"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </a>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';

  // Projects header - horizontal line wipe
  gsap.fromTo('.projects-header',
    { opacity: 0, clipPath: 'inset(0 100% 0 0)' },
    {
      opacity: 1,
      clipPath: 'inset(0 0% 0 0)',
      duration: 1.2,
      ease: 'power4.inOut',
      scrollTrigger: {
        trigger: '.projects-header',
        start: 'top 80%',
        once: true,
      },
    }
  );

  // Project cards - alternating slide from left/right
  document.querySelectorAll('.project-card').forEach((card) => {
    const index = Number(card.getAttribute('data-index'));
    const fromX = index % 2 === 0 ? -60 : 60;

    gsap.fromTo(card,
      { opacity: 0, x: fromX },
      {
        opacity: 1,
        x: 0,
        duration: 1,
        ease: 'power3.out',
        scrollTrigger: {
          trigger: card,
          start: 'top 85%',
          once: true,
        },
      }
    );
  });

  // Parallax on browser mockups
  document.querySelectorAll('.browser-mockup img').forEach((img) => {
    gsap.fromTo(img,
      { y: 20 },
      {
        y: -20,
        ease: 'none',
        scrollTrigger: {
          trigger: img.closest('article'),
          start: 'top bottom',
          end: 'bottom top',
          scrub: 1,
        },
      }
    );
  });

  // Project link hover
  document.querySelectorAll('.project-link').forEach((link) => {
    const arrow = link.querySelector('.project-arrow');
    
    link.addEventListener('mouseenter', () => {
      gsap.to(link, { color: '#a1a1aa', duration: 0.3 });
      gsap.to(arrow, { x: 3, y: -3, duration: 0.3, ease: 'power2.out' });
    });
    
    link.addEventListener('mouseleave', () => {
      gsap.to(link, { color: '#ffffff', duration: 0.3 });
      gsap.to(arrow, { x: 0, y: 0, duration: 0.3, ease: 'power2.out' });
    });
  });
</script>
