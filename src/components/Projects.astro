---
import { Image } from 'astro:assets';

import { projects } from '../data/projects';
---

<section id="projects" class="relative border-t border-white/10 bg-zinc-950 px-6 py-32 text-white md:px-12">
  <div class="mx-auto max-w-[90vw]">
    <div class="reveal-text mb-32 flex items-end justify-between border-b border-white/10 pb-8">
      <h2 class="text-7xl font-bold tracking-tighter text-white md:text-9xl">
        SELECTED<br />WORKS
      </h2>
      <span class="mb-2 hidden font-mono text-sm text-zinc-400 md:block">
        (2023 â€” {new Date().getFullYear()})
      </span>
    </div>

    <div class="flex flex-col gap-40">
      {
        projects.map((project, index) => (
          <div class="group relative grid grid-cols-1 gap-12 md:grid-cols-12 md:gap-8">
            {/* Sticky Project Info */}
            <div class="reveal-text md:col-span-4 md:sticky md:top-32 md:h-fit md:py-4">
              <span class="mb-6 block font-mono text-xs text-zinc-400">0{index + 1} / PROJECT</span>

              <h3 class="mb-6 text-4xl font-bold tracking-tight md:text-6xl">
                {project.title}
              </h3>

              <div class="mb-8 flex flex-wrap gap-2">
                {project.tech.map((t) => (
                  <span class="rounded-full border border-white/10 px-3 py-1 text-xs tracking-widest text-zinc-400 uppercase">
                    {t}
                  </span>
                ))}
              </div>

              <p class="mb-10 max-w-sm text-lg leading-relaxed text-zinc-400">
                {project.blurb}
              </p>

              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="magnetic group/btn inline-flex items-center gap-3 text-sm font-bold tracking-widest uppercase"
              >
                <span class="relative overflow-hidden">
                  <span class="block transition-transform duration-300 group-hover/btn:-translate-y-full">View Live</span>
                  <span class="absolute top-full left-0 block transition-transform duration-300 group-hover/btn:-translate-y-full text-zinc-400">View Live</span>
                </span>
                <svg
                  width="10"
                  height="10"
                  viewBox="0 0 10 10"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="transition-transform duration-300 group-hover/btn:translate-x-1 group-hover/btn:-translate-y-1"
                >
                  <path
                    d="M1 9L9 1M9 1H1M9 1V9"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </a>
            </div>

            {/* Image / Parallax Container */}
            <div class="reveal-text md:col-span-8">
              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="relative block w-full overflow-hidden rounded-sm bg-zinc-900"
              >
                <div class="absolute inset-0 z-10 bg-zinc-950/20 transition-opacity duration-500 group-hover:opacity-0"></div>
                <div class={`relative aspect-video w-full overflow-hidden ${project.slug === 'ioannislo' ? 'bg-[#0A0A0A]' : project.slug === 'email-scraper' ? 'bg-[#111727]' : 'bg-zinc-900'}`}>
                   <Image
                    src={project.cover}
                    alt={project.title}
                    class={`h-full w-full opacity-80 transition-all duration-700 group-hover:opacity-100 ${project.slug === 'ioannislo' || project.slug === 'email-scraper' ? 'object-contain' : 'object-cover'}`}
                    quality={95}
                  />
                </div>
              </a>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>



<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Parallax Images
  const projectImages = document.querySelectorAll('#projects img');
  
  projectImages.forEach((img) => {
    gsap.fromTo(img, 
      { scale: 1.2 },
      {
        scale: 1,
        scrollTrigger: {
          trigger: img.parentElement, // The wrapper
          start: 'top bottom',
          end: 'bottom top',
          scrub: 1,
        },
        ease: 'none'
      }
    );
  });

  // Pinning adjustments for smoother experience on mobile/desktop
  // (Optional: if we wanted to enforce pin spacing or similar)
</script>
