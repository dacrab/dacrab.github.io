---
import { Image } from 'astro:assets';

import { projects } from '../data/projects';
---

<section id="projects" class="border-t border-zinc-200 px-6 py-32 md:px-12">
  <div class="mx-auto max-w-7xl">
    <div class="reveal-text mb-24 flex items-end justify-between">
      <h2 class="text-8xl font-bold tracking-tighter text-zinc-200 select-none md:text-9xl">
        WORK
      </h2>
      <p class="mb-4 text-lg text-zinc-500">Selected Projects (0{projects.length})</p>
    </div>

    <div class="space-y-32">
      {
        projects.map((project, index) => (
          <div class="group project-item relative grid grid-cols-1 items-center gap-8 lg:grid-cols-12">
            {/* Text Content */}
            <div class="reveal-text z-10 order-2 mix-blend-multiply lg:order-1 lg:col-span-5">
              <div class="mb-6 flex items-center gap-4">
                <span class="font-mono text-sm text-zinc-400">0{index + 1}</span>
                <div class="h-px w-12 bg-zinc-200" />
                <span class="text-xs font-bold tracking-widest text-zinc-500 uppercase">
                  {project.slug}
                </span>
              </div>

              <h3 class="mb-6 text-4xl font-bold text-zinc-900 transition-colors group-hover:text-zinc-600 md:text-5xl">
                {project.title}
              </h3>

              <p class="mb-8 max-w-md text-xl leading-relaxed text-zinc-500">{project.blurb}</p>

              <div class="mb-10 flex flex-wrap gap-2">
                {project.tech.map((t) => (
                  <span class="rounded-full border border-zinc-200 px-3 py-1 text-xs font-medium tracking-wider text-zinc-500 uppercase">
                    {t}
                  </span>
                ))}
              </div>

              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="magnetic inline-flex items-center gap-2 border-b border-zinc-900 pb-1 text-sm font-bold tracking-widest text-zinc-900 uppercase transition-opacity hover:opacity-60"
              >
                View Live
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M1 11L11 1M11 1H1M11 1V11"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </a>
            </div>

            {/* Image Content */}
            <div class="reveal-text relative order-1 delay-200 lg:order-2 lg:col-span-7">
              <a
                href={project.link}
                target="_blank"
                rel="noopener noreferrer"
                class="project-image-container relative block h-[60vh] overflow-hidden rounded-sm bg-zinc-100"
              >
                <div class="project-image-wrapper absolute inset-0 -top-[10%] h-[120%] w-full">
                  <Image
                    src={project.cover}
                    alt={project.title}
                    class="h-full w-full object-cover object-top grayscale transition-all duration-700 group-hover:grayscale-0"
                    quality={95}
                  />
                </div>
              </a>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .delay-200 {
    transition-delay: 200ms;
  }
</style>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const images = document.querySelectorAll('.project-image-wrapper');

  images.forEach((img) => {
    gsap.to(img, {
      y: '10%', // Move image slightly down within its container
      ease: 'none',
      scrollTrigger: {
        trigger: img.parentElement,
        start: 'top bottom', // when top of container hits bottom of viewport
        end: 'bottom top', // when bottom of container hits top of viewport
        scrub: true,
      },
    });
  });
</script>
