---
const links = [
  { label: 'Work', href: '#projects' },
  { label: 'About', href: '#about' },
  { label: 'Contact', href: '#contact' },
];
---

<header class="fixed top-0 right-0 left-0 z-50 text-white mix-blend-difference">
  <div class="flex items-center justify-between px-6 py-8 md:px-12">
    <a
      href="#hero-section"
      aria-label="Back to top"
      class="header-reveal magnetic inline-block -translate-y-full text-sm font-bold tracking-widest uppercase opacity-0"
    >
      Vaggelis <span class="crab-trigger inline-block">Kavouras</span>
    </a>

    <button
      id="menu-toggle"
      class="header-reveal group relative z-50 flex h-8 w-12 -translate-y-full cursor-pointer flex-col items-end justify-center gap-1.5 opacity-0 mix-blend-difference"
      aria-label="Toggle Menu"
      aria-expanded="false"
      aria-controls="menu-overlay"
    >
      <span id="bar-top" class="h-[2px] w-full bg-white"></span>
      <span id="bar-bottom" class="h-[2px] w-3/4 bg-white"></span>
    </button>
  </div>
</header>

<div
  id="menu-overlay"
  class="fixed inset-0 z-40 flex translate-x-full flex-col items-center justify-center bg-zinc-950 text-white"
>
  <nav>
    <ul class="flex flex-col items-center gap-8">
      {
        links.map((link) => (
          <li class="menu-item translate-y-8 opacity-0">
            <a
              href={link.href}
              class="magnetic group relative inline-block text-4xl font-bold tracking-tighter uppercase md:text-6xl"
            >
              {link.label}
            </a>
          </li>
        ))
      }
      <li class="menu-item translate-y-8 opacity-0">
        <div class="mt-8 flex flex-col items-center gap-4">
          <span class="text-sm font-medium tracking-widest text-zinc-500 uppercase">Resume</span>
          <div class="flex gap-4">
            <a
              href="/CV/VAGGELIS_KAVOURAS_EN.pdf"
              target="_blank"
              rel="noopener noreferrer"
              class="magnetic relative inline-block text-sm font-bold tracking-widest uppercase"
            >
              EN
            </a>
            <span class="text-zinc-600">/</span>
            <a
              href="/CV/VAGGELIS_KAVOURAS_EL.pdf"
              target="_blank"
              rel="noopener noreferrer"
              class="magnetic relative inline-block text-sm font-bold tracking-widest uppercase"
            >
              GR
            </a>
          </div>
        </div>
      </li>
    </ul>
  </nav>
</div>

<script>
  import gsap from 'gsap';

import { DURATION, EASE } from '../utils/animations';

  const menuToggle = document.getElementById('menu-toggle');
  const menuOverlay = document.getElementById('menu-overlay');
  const menuItems = document.querySelectorAll('.menu-item');
  const topBar = document.getElementById('bar-top');
  const bottomBar = document.getElementById('bar-bottom');
  let isMenuOpen = false;

  gsap.to('.header-reveal', {
    y: 0,
    opacity: 1,
    duration: 1.2,
    stagger: 0.15,
    ease: EASE.EXPO,
    delay: 0.3,
  });

  if (!menuToggle || !menuOverlay || !topBar || !bottomBar) {
    throw new Error('Header: required menu elements not found');
  }

  menuToggle.addEventListener('mouseenter', () => {
    if (isMenuOpen) return;
    gsap.to(topBar, { width: '75%', duration: DURATION.DEFAULT, ease: EASE.DEFAULT, overwrite: 'auto' });
    gsap.to(bottomBar, { width: '100%', duration: DURATION.DEFAULT, ease: EASE.DEFAULT, overwrite: 'auto' });
  });

  menuToggle.addEventListener('mouseleave', () => {
    if (isMenuOpen) return;
    gsap.to(topBar, { width: '100%', duration: DURATION.DEFAULT, ease: EASE.DEFAULT, overwrite: 'auto' });
    gsap.to(bottomBar, { width: '75%', duration: DURATION.DEFAULT, ease: EASE.DEFAULT, overwrite: 'auto' });
  });

  const MENU = {
    open: {
      body: 'hidden',
      overlay: { x: '0%', duration: DURATION.SLOWER, ease: EASE.EXPO_IN_OUT },
      items: { y: 0, opacity: 1, duration: 1, stagger: 0.1, delay: DURATION.MEDIUM, ease: EASE.EXPO },
      topBar: { rotate: 45, y: 4, width: '100%', duration: DURATION.MEDIUM, ease: EASE.EXPO },
      bottomBar: { rotate: -45, y: -4, width: '100%', duration: DURATION.MEDIUM, ease: EASE.EXPO },
    },
    closed: {
      body: '',
      overlay: { x: '100%', duration: DURATION.SLOWER, ease: EASE.EXPO_IN_OUT },
      items: { y: 20, opacity: 0, duration: DURATION.MEDIUM, ease: EASE.EXPO_IN },
      topBar: { rotate: 0, y: 0, width: '100%', duration: DURATION.MEDIUM, ease: EASE.EXPO },
      bottomBar: { rotate: 0, y: 0, width: '75%', duration: DURATION.MEDIUM, ease: EASE.EXPO },
    },
  } as const;

  menuToggle.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    menuToggle.setAttribute('aria-expanded', String(isMenuOpen));

    const state = isMenuOpen ? MENU.open : MENU.closed;
    document.body.style.overflow = state.body;
    gsap.to(menuOverlay, state.overlay);
    gsap.to(menuItems, state.items);
    gsap.to(topBar, state.topBar);
    gsap.to(bottomBar, state.bottomBar);
  });

  // Close menu when clicking nav items
  for (const item of menuItems) {
    item.addEventListener('click', () => {
      if (isMenuOpen) menuToggle.click();
    });
  }
</script>
